---
title: "House Price ê²½ì§„ëŒ€íšŒì˜ ë°ì´í„° ì „ì²˜ë¦¬, ëª¨ë¸ë§ ë° í•™ìŠµê³¼ Benz Grenner Manufacturing ë°ì´í„° ì „ì²˜ë¦¬"
excerpt: "2022-11-15 House Price ë°ì´í„°ì˜ ëª¨ë¸ë§ ë° í•™ìŠµ, ë²¤ì¸  ê²½ì§„ëŒ€íšŒì˜ ë°ì´í„° ì¼ë¶€ë¥¼ ì „ì²˜ë¦¬"

# layout: post
categories:
  - TIL
tags:
  - python
  - EDA
  - Learning Machine
  - Feature Scaling
  - Transformation
  - log function
  - exponential function
  - Discretisation
  - Encoding
  - Feature Generation
  - Feature Engineering
spotifyplaylist: spotify/playlist/2KaQr0nx66AX399ZLLuTVf?si=43a48325c8fc4b16
---
### **âš ï¸ í•´ë‹¹ ë‚´ìš©ì€ ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼ AI School ì˜¤ëŠ˜ì½”ë“œ ë°•ì¡°ì€ ê°•ì‚¬ì˜ ìë£Œë¥¼ í† ëŒ€ë¡œ ì •ë¦¬í•œ ë‚´ìš©ì…ë‹ˆë‹¤.**
{% include spotifyplaylist.html id=page.spotifyplaylist %}


**[ì§€ë‚œ í¬ìŠ¤íŠ¸](https://junstar21.github.io/til/feature-engineering-example/)ì—ì„œ ì´ì–´ì§**

**âš ï¸ ê²°ì¸¡ì¹˜/ì´ìƒì¹˜ ì œê±°ì‹œ ì£¼ì˜ì‚¬í•­**

ê²°ì¸¡ì¹˜ê°€ ë§ë‹¤ê³  ì‚­ì œí•˜ëŠ”ê²Œ ë¬´ì¡°ê±´ ë‚˜ì€ ë°©ë²•ì´ ì•„ë‹ ìˆ˜ë„ ìˆë‹¤. ì´ìƒì¹˜, íŠ¹ì‡ê°’ì„ ì°¾ëŠ”ë‹¤ë©´ ì˜¤íˆë ¤ íŠ¹ì • ê°’ì´ ì‹ í˜¸ê°€ ë  ìˆ˜ë„ ìˆë‹¤. ë²”ì£¼í˜• ê°’ì´ë¼ë©´ ê²°ì¸¡ì¹˜ê°€ ë§ë”ë¼ë„ ì±„ìš°ì§€ ì•Šê³  ì¸ì½”ë”©í•´ì£¼ë©´ ë‚˜ë¨¸ì§€ ì—†ëŠ” ê°’ì€ 0ìœ¼ë¡œ ì±„ì›Œì§€ê²Œ ë˜ëŠ” ëŒ€ì‹  í¬ì†Œí•œ í–‰ë ¬ì´ ìƒì„±ëœë‹¤. ê·¸ë¦¬ê³ , ìˆ˜ì¹˜ë°ì´í„°ì¸ë° ê²°ì¸¡ì¹˜ë¼ë©´ ì˜ëª»ì±„ì› ì„ ë•Œ ë¬¸ì œê°€ ë§ìœ¼ë‹ˆ ì£¼ì˜ê°€ í•„ìš”í•˜ë‹¤.
ì–¸ì œ ì–´ë–¤ ë°©ë²•ì„ ì‚¬ìš©í•´ì•¼í• ì§€ ëª¨ë¥´ê² ë‹¤ë©´ ë…¸íŠ¸ë¶ í•„ì‚¬ë¥¼ ì—¬ëŸ¬ ê°œ í•´ë³´ê³  ë‹¤ì–‘í•œ ë°ì´í„°ì…‹ì„ ë‹¤ë¤„ë³´ëŠ”ê²ƒì„ ì¶”ì²œí•œë‹¤. ì§€ê¸ˆê¹Œì§€ ë‹¤ë¤„ë³¸ ë°ì´í„°ì…‹ì´ ë§ì§€ ì•Šê¸° ë•Œë¬¸ì— ì¢€ ë” ìˆ˜ë ¨ì´ í•„ìš”í•˜ê³ , ê²½í—˜ì¹˜ë¥¼ ë§ì´ ìŒ“ëŠ”ê²Œ ì¤‘ìš”í•˜ë‹¤.

**ğŸ¤” ì™œë„ì™€ ì²¨ë„ì˜ ì •í™•í•œ ìˆ˜ì¹˜ê¹Œì§€ ì•Œì•„ì•¼í•  í•„ìš”ê°€ ìˆë‚˜ìš”?**

ì •í™•í•œ ìˆ˜ì¹˜ê¹Œì§€ ëª¨ë¥´ë”ë¼ë„ ì‹œê°í™”ë¥¼ í•´ë³´ë©´ ì•Œ ìˆ˜ ìˆìœ¼ë‚˜, ë³€ìˆ˜ê°€ 100ê°œ ê·¸ ì´ìƒì´ë¼ë©´? í•˜ë‚˜ì”© ë‹¤ ë¹„êµí•´ ë³¼ ìˆ˜ ìˆì§€ë§Œ ë§ì€ ì‹œê°„ì´ ì†Œìš”ëœë‹¤. [Anscombe's Quartet](https://seaborn.pydata.org/examples/anscombes_quartet.html) ë°ì´í„°ë¥¼ ìƒê°í•´ ë³´ë©´ ìš”ì•½ëœ ê¸°ìˆ  í†µê³„ëŠ” ë°ì´í„°ë¥¼ ìì„¸íˆ ì„¤ëª…í•˜ì§€ ëª»í•˜ëŠ” ë¶€ë¶„ë„ ìˆì„ ìˆ˜ ìˆë‹¤. ê·¸ë˜ì„œ ì™œë„ì™€ ì²¨ë„ëŠ” ë³€ìˆ˜ê°€ ìˆ˜ë°±ê°œ ë  ë•Œ ì „ì²´ì ìœ¼ë¡œ ì™œë„ì™€ ì²¨ë„ê°€ ë†’ì€ ê°’ì„ ì¶”ì¶œí•´ì„œ ì „ì²˜ë¦¬ë¥¼ í•´ ì¤„ ìˆ˜ ìˆë‹¤. ì§€ë‚œ ë²ˆ ì‹¤ìŠµí–ˆë˜ ì˜ˆë¥¼ ë³´ë©´ ì™œë„ë‚˜ ì²¨ë„ê°€ ë†’ì€ ê°’ì„ ì¶”ì¶œí•´ì„œ ë³€í™˜í•˜ëŠ” ì „ì²˜ë¦¬ë¥¼ ì§„í–‰í•  ìˆ˜ë„ ìˆë‹¤. pandas, numpy ë“±ìœ¼ë¡œ ê¸°ìˆ í†µê³„ë¥¼ êµ¬í•´ë³´ë©´ ì™œë„, ì²¨ë„(ê¸°ë³¸ ê°’ í”¼ì…”ì˜ ì •ì˜ ì¼ ë•Œ) 0ì— ê°€ê¹Œìš¸ ë•Œ ì •ê·œë¶„í¬ì— ê°€ê¹Œìš´ ëª¨ìŠµì„ ë³´ì¸ë‹¤.

### log ë³€í™˜

```python
log_features = ['LotFrontage','LotArea','MasVnrArea','BsmtFinSF1','BsmtFinSF2','BsmtUnfSF',
                 'TotalBsmtSF','1stFlrSF','2ndFlrSF','LowQualFinSF','GrLivArea',
                 'BsmtFullBath','BsmtHalfBath','FullBath','HalfBath','BedroomAbvGr','KitchenAbvGr',
                 'TotRmsAbvGrd','Fireplaces','GarageCars','GarageArea','WoodDeckSF','OpenPorchSF',
                 'EnclosedPorch','3SsnPorch','ScreenPorch','PoolArea','MiscVal','YearRemodAdd']
```

ìœ„ `log_features` ì¤‘ì—ì„œ ìˆ˜ì¹˜í˜• ë³€ìˆ˜ë§Œ logë¡œ ë³€í™˜í•´ì£¼ë„ë¡ í•˜ì.

```python
num_cat_feature = df[log_features].nunique()
# nuniqueì˜ ê°’ì´ 20ê°œ ì´í•˜ì¸ featureë¥¼ íƒìƒ‰í•œë‹¤. ê°’ì´ ì ë‹¤ëŠ” ê²ƒì€ ë¶„ë¥˜í˜•ì¼ ê°€ëŠ¥ì„±ì´ ë†’ë‹¤.
num_cat_feature = num_cat_feature[num_cat_feature < 20].index
# log_featuresì—ì„œ ë¶„ë¥˜í˜• featureì¸ num_cat_featureë¥¼ ì œì™¸í•œë‹¤.
num_cat_feature = list(set(log_features) - set(num_cat_feature))

df[num_cat_feature] = np.log1p(df[num_cat_feature])

df[num_cat_feature].hist(bins = 100, figsize = (12,8));
```

![]({{ site.url }}{{ site.baseurl }}/assets/images/2022-11-15-hp,bz/Untitled.png)

### **squared features (Polynomials)**

squared featuresë¥¼ í•´ì¤„ featureë¥¼ ì„ ì •í•´ì¤€ë‹¤.

```python
squared_features = ['YearRemodAdd', 'LotFrontage', 
              'TotalBsmtSF', '1stFlrSF', '2ndFlrSF', 'GrLivArea',
              'GarageCars', 'GarageArea']
df[squared_features].hist(figsize=(12, 8), bins=50)
plt.show()
```

![]({{ site.url }}{{ site.baseurl }}/assets/images/2022-11-15-hp,bz/Untitled 1.png)

ì‚¬ì´í‚· ëŸ°ì—ì„œ Polynomialsë¡œ ë³€ìˆ˜ë¥¼ ë§Œë“œëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ê³  ìˆì§€ë§Œ, ì§ì ‘ ì œê³±ì„ í•´ì¤˜ë„ ëœë‹¤.
ìœ ë‹ˆí¼í•œ ë¶„í¬ì— ì‚¬ìš©í•œë‹¤. ì—¬ê¸°ì—ì„œëŠ” ì‚¬ìš©í• ë§Œí•œ ë³€ìˆ˜ê°€ ë³´ì´ì§€ ì•Šì§€ë§Œ, Polynomialsë¥¼ ì‚¬ìš©í•´ ë³¼ ìˆ˜ ìˆë‹¤ëŠ” ì ì„ ê³ ë ¤í•˜ì.

```python
# squared_features

df_square = df[squared_features] ** 2
```

histplotì„ ì´ìš©í•´ì„œ ì‹œê°í™”ë¥¼ í•˜ì—¬ ì°¨ì´ë¥¼ í™•ì¸í•´ë³¸ë‹¤. uniformí•œ ë¶„í¬ê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ì—¬ê¸°ì—ì„œëŠ” ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ê´œì°®ì•„ ë³´ì¸ë‹¤. ê°’ì„ ê°•ì¡°í•´ì„œ êµ¬ë¶„í•˜ê³ ì í•  ë•Œ ì£¼ë¡œ ì‚¬ìš©í•œë‹¤.

```python
df_square.hist(figsize=(12, 8), bins = 100);
```

![]({{ site.url }}{{ site.baseurl }}/assets/images/2022-11-15-hp,bz/Untitled 2.png)

## ë²”ì£¼í˜• ë³€ìˆ˜ ë³´ê¸°

ë²”ì£¼í˜• ë³€ìˆ˜ì—ì„œ ê²°ì¸¡ì¹˜ê°€ ì—†ëŠ” ë³€ìˆ˜ ì°¾ì•„ë‚¸ë‹¤. ë²”ì£¼í˜• ë³€ìˆ˜ ì¤‘ ê²°ì¸¡ì¹˜ê°€ ìˆëŠ”ì§€ í™•ì¸í•´ë³´ê³  ì–´ë–¤ ë²”ì£¼í˜• ë³€ìˆ˜ë¥¼ ì„ íƒí•´ì„œ ëª¨ë¸ì— ì‚¬ìš©í• ì§€ ì˜ì‚¬ê²°ì •ì„ í•˜ê²Œ ëœë‹¤. ìœ„ì—ì„œ ì´ë¯¸ ê²°ì¸¡ì¹˜ë¥¼ ëŒ€ë¶€ë¶„ ì±„ì›Œì¤¬ê¸° ë•Œë¬¸ì— ëŒ€ë¶€ë¶„ì˜ ê²°ì¸¡ì¹˜ê°€ ì²˜ë¦¬ë˜ì—ˆê³ , ì¼ë¶€ë§Œ ë‚¨ì•„ìˆë‹¤. ì •ë ¬ì„ í•˜ê³  ê²°ì¸¡ì¹˜ê°€ ìˆëŠ” ë°ì´í„°ë¥¼ ì œê±°í•˜ê¸° ìœ„í•´ ìŠ¬ë¼ì´ì‹±ì„ ì‚¬ìš©í•˜ë„ë¡ í•œë‹¤. ë²”ì£¼í˜• ë°ì´í„°ëŠ” ì›í•«ì¸ì½”ë”©ì„ ì‘ì—…í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ê²°ì¸¡ì¹˜ë¥¼ ë‚¨ê²¨ë„ ìƒê´€ì—†ë‹¤(ì—†ëŠ” ê°’ì€ ë³€ìˆ˜ë¡œ ìƒì„±í•˜ì§€ ì•ŠëŠ”ë‹¤).

```python
df_cate = df.select_dtypes(include="object")
df_cate.isnull().mean().sort_values()
```

- ê²°ê³¼ê°’
    
    ```python
    MSSubClass       0.000000
    BsmtQual         0.000000
    BsmtCond         0.000000
    BsmtExposure     0.000000
    BsmtFinType1     0.000000
    BsmtFinType2     0.000000
    Heating          0.000000
    HeatingQC        0.000000
    CentralAir       0.000000
    KitchenQual      0.000000
    Functional       0.000000
    GarageType       0.000000
    GarageFinish     0.000000
    GarageQual       0.000000
    GarageCond       0.000000
    PavedDrive       0.000000
    MoSold           0.000000
    YrSold           0.000000
    SaleType         0.000000
    ExterCond        0.000000
    Foundation       0.000000
    Condition1       0.000000
    MSZoning         0.000000
    Street           0.000000
    LotShape         0.000000
    LandContour      0.000000
    LotConfig        0.000000
    LandSlope        0.000000
    Neighborhood     0.000000
    ExterQual        0.000000
    SaleCondition    0.000000
    Condition2       0.000000
    BldgType         0.000000
    HouseStyle       0.000000
    OverallCond      0.000000
    RoofStyle        0.000000
    RoofMatl         0.000000
    Exterior1st      0.000000
    Exterior2nd      0.000000
    Electrical       0.000343
    Utilities        0.000685
    MasVnrType       0.008222
    FireplaceQu      0.486468
    dtype: float64
    ```
    

ë§ˆì§€ë§‰ ë‘ê°œì˜ ë³€ìˆ˜ë“¤ì„ ì œê±°í•œ ìƒˆë¡œìš´ featureì˜ ë¬¶ìŒì„ ë§Œë“¤ë„ë¡ í•œë‹¤.

```python
feature_cate = df_cate.isnull().mean().sort_values()[:-2].index
```

## Make feature

### label name

`label_name`ë³€ìˆ˜ì— ì˜ˆì¸¡ì— ì‚¬ìš©í•  ì •ë‹µê°’ì„ ì§€ì •í•œë‹¤.

```python
label_name = "SalePrice_log1p"
```

**ğŸ¤” ì •ë‹µê°’ì´ ì™œ `log1p`ì¸ê°€?**

ê²½ì§„ëŒ€íšŒì˜ submitionì„ í™•ì¸í•´ë³´ì.
Submissions are evaluated on Root-Mean-Squared-Error (RMSE) between the logarithm of the predicted value and the logarithm of the observed sales price. (Taking logs means that errors
in predicting expensive houses and cheap houses will affect the result equally.)
ì§‘ê°’ì„ 2ì–µ=>4ì–µìœ¼ë¡œ ì˜ˆì¸¡í•˜ëŠ” ëª¨ë¸ë¡œ 100ì–µ=>110ì–µìœ¼ë¡œ ì˜ˆì¸¡í–ˆì„ ë•Œ ì–´ë””ì— ë” íŒ¨ë„í‹°ë¥¼ ì¤„ ê²ƒì¸ì§€ë¥¼ ìƒê°í•´ë³´ë©´ MAE(ì˜¤ì°¨ì˜ ì ˆëŒ€ê°’)ëŠ” ì²«ë²ˆì§¸ëŠ” 2ì–µì°¨ì´, ë‘ë²ˆì§¸ëŠ” 10ì–µìœ¼ë¡œ íŒë‹¨í•œë‹¤. ë°˜ë©´, MSEëŠ” ì²«ë²ˆì§¸ëŠ” 4ì–µì°¨ì´, ë‘ë²ˆì§¸ëŠ” 100ì–µì°¨ì´ë¡œ ì±…ì •í•˜ë©° ì˜¤ì°¨ê°€ í¬ë©´ í´ìˆ˜ë¡ ê°’ì€ ë” ë²Œì–´ì§„ë‹¤.
RMSLEì˜ ê²½ìš°, ì²«ë²ˆì§¸ëŠ” np.log(2) => 0.69, ë‘ë²ˆì§¸ëŠ” np.log(10) => 2.30ìœ¼ë¡œ í‰ê°€í•œë‹¤. ì¦‰, ë¡œê·¸ê°’ì€ ì‘ì€ ê°’ì—ì„œ ë” íŒ¨ë„í‹°ë¥¼ ì£¼ê³  ê°’ì´ ì»¤ì§ì— ë”°ë¼ ì™„ë§Œí•˜ê²Œ ì¦ê°€í•˜ê²Œ ëœë‹¤. ë¡œê·¸ê°’ì´ ì‘ì€ ê°’ì—ì„œ ë” íŒ¨ë„í‹°ë¥¼ ì£¼ëŠ” ê²ƒì€ ë¡œê·¸ ê·¸ë˜í”„ë¥¼ ë– ì˜¬ë ¤ ë³´ëŠ” ê²ƒì´ ë„ì›€ì´ ë  ê²ƒì´ë‹¤.

### Feature names

```python
feature_names = []
feature_names.extend(num_log_feature)
feature_names.append("TotalSF")
feature_names.extend(feature_cate)
feature_names.remove("1stFlrSF")
feature_names.remove("2ndFlrSF")
feature_names.remove("BsmtFinSF1")
feature_names.remove("BsmtFinSF2")
feature_names
```

- ê²°ê³¼ê°’
    
    ```
    ['MiscVal',
     '3SsnPorch',
     'EnclosedPorch',
     'YearRemodAdd',
     'GarageArea',
     'LotArea',
     'ScreenPorch',
     'LotFrontage',
     'TotalBsmtSF',
     'WoodDeckSF',
     'OpenPorchSF',
     'GrLivArea',
     'LowQualFinSF',
     'BsmtUnfSF',
     'MasVnrArea',
     'TotalSF',
     'MSSubClass',
     'BsmtQual',
     'BsmtCond',
     'BsmtExposure',
     'BsmtFinType1',
     'BsmtFinType2',
     'Heating',
     'HeatingQC',
     'CentralAir',
     'KitchenQual',
     'Functional',
     'GarageType',
     'GarageFinish',
     'GarageQual',
     'GarageCond',
     'PavedDrive',
     'MoSold',
     'YrSold',
     'SaleType',
     'ExterCond',
     'Foundation',
     'Condition1',
     'MSZoning',
     'Street',
     'LotShape',
     'LandContour',
     'LotConfig',
     'LandSlope',
     'Neighborhood',
     'ExterQual',
     'SaleCondition',
     'Condition2',
     'BldgType',
     'HouseStyle',
     'OverallCond',
     'RoofStyle',
     'RoofMatl',
     'Exterior1st',
     'Exterior2nd',
     'Electrical',
     'Utilities']
    ```
    

### One-Hot-Encoding

```python
df_ohe = pd.get_dummies(data = df[feature_names])

# ì›í•«ì¸ì½”ë”© í›„ ê¸°ì¡´ ë°ì´í„°ì™€ ê°œìˆ˜ë¥¼ ë¹„êµ
df.shape, df_ohe.shape

ê²°ê³¼ê°’ :
((2919, 77), (2919, 297))
```

## ë°ì´í„°ì…‹ ë§Œë“¤ê¸°

```python
# train, test ë°ì´í„°ì…‹ ë‚˜ëˆ„ê¸°
train.index, test.index

# X, yë¡œ í•™ìŠµê³¼ ì˜ˆì¸¡ ë°ì´í„° ë§Œë“¤ì–´ì£¼ê¸°
X_train = df_ohe.loc[train.index]
X_test = df_ohe.loc[test.index]
y_train = train[label_name]
```

## ëŸ¬ë‹ë¨¸ì‹  ëª¨ë¸

íšŒê·€ ì˜ˆì¸¡ì´ê¸° ë•Œë¬¸ì— RandomForestRegressorë¥¼ ì‚¬ìš©í•˜ë„ë¡œê³  í•œë‹¤.

```python
from sklearn.ensemble import RandomForestRegressor
model = RandomForestRegressor(random_state= 42)
```

### **KFold ë¡œ Cross Validation í•˜ê¸°**

```python
# KFold ë¥¼ ì‚¬ìš©í•´ì„œ ë¶„í• ì„ ë‚˜ëˆ•ë‹ˆë‹¤.
# ë¶„í• ì— random_stateë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
# ë¶„í•  ë•Œë¬¸ì— ê°’ì´ ë³€ê²½ëœê±´ì§€ ì‹¤í—˜ì„ ì¢€ ë” ê³ ì •í•  ìˆ˜ ìˆë‹¤.

from sklearn.model_selection import KFold

# KFold : ë¨¼ì € Kê°œì˜ ë°ì´í„° í´ë“œ ì„¸íŠ¸ë¥¼ ë§Œë“¤ì–´ì„œ Kë²ˆë§Œí¼ ê° í´ë“œ ì„¸íŠ¸ì— í•™ìŠµê³  ê²€ì¦ í‰ê°€ë¥¼ 1ë°˜ë³µì ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•
kf = KFold(random_state=42, n_splits = 5, shuffle=True)
```

### **cross_val_score ì™€ cross_val_predict ë¡œ ì ìˆ˜ êµ¬í•˜ê¸°**

```python
from sklearn.model_selection import cross_val_predict

y_val_pred = cross_val_predict(model, X_train, y_train, cv = kf, n_jobs = -1)
```

### Metric

RMSEë¡œ ì˜¤ì°¨ ì¸¡ì •ì„ ê³„ì‚°í•´ì¤€ë‹¤.

```python
from sklearn.metrics import mean_squared_error

mse = mean_squared_error(y_train, y_val_pred)
ê²°ê³¼ê°’ : 0.02376825784998244

rmse = np.sqrt(mse)
ê²°ê³¼ê°’ : 0.15416957498151976
```

### ì‹¤ì œê°’ê³¼ ì˜ˆì¸¡ê°’ ë¹„êµí•˜ê¸°

```python
# regplot ìœ¼ë¡œ ì˜ˆì¸¡ê°’ì— ëŒ€í•œ íšŒê·€ì„  ê·¸ë¦¬ê¸°
sns.regplot(x=y_train, y = y_val_pred)
```

![]({{ site.url }}{{ site.baseurl }}/assets/images/2022-11-15-hp,bz/Untitled 3.png)

**R2 Scoreë¡œ ì˜¤ì°¨ ì¸¡ì •**

R2 ScoreëŠ” 1ì— ê°€ê¹Œìš´ í° ê°’ì¼ ìˆ˜ë¡ ì˜ ì˜ˆì¸¡í•œ ê°’ì´ë‹¤.

```python
from sklearn.metrics import r2_score

r2_score(y_train, y_val_pred)
ê²°ê³¼ê°’ : 0.8509363870476118
```

**KDE Plot**

```python
sns.kdeplot(y_train)
sns.kdeplot(y_val_pred)
```

![]({{ site.url }}{{ site.baseurl }}/assets/images/2022-11-15-hp,bz/Untitled 4.png)

## í•™ìŠµ(í›ˆë ¨) ë° ì˜ˆì¸¡

```python
# í•™ìŠµ ê³¼ ì˜ˆì¸¡ì„ í•œë²ˆì— ì§„í–‰í•´ì¤€ë‹¤.
y_pred = model.fit(X_train, y_train).predict(X_test)

```

### feature ì¤‘ìš”ë„ ë³´ê¸°

ì „ê³¼ ë‹¤ë¥´ê²Œ ì´ë²ˆ ë°ì´í„°ì—ëŠ” featureê°€ êµ‰ì¥íˆ ë§ê¸° ë•Œë¬¸ì— ì „ê³¼ ë™ì¼í•˜ê²Œ ì§„í–‰í•˜ë©´ í”¼ì²˜ ì¤‘ìš”ë„ì˜ ì‹œê°í™”ê°€ ì œëŒ€ë¡œ ì´ë£¨ì–´ì§€ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ, ìƒìœ„ 20ê°œì˜ ì¤‘ìš” ë°ì´í„°ë§Œ ë”°ë¡œ ì‹œê°í™”ë¥¼ ì§„í–‰í•˜ë„ë¡ í•œë‹¤.

```python
# ì¤‘ìš”ë„ ìƒìœ„ í”¼ì²˜ë§Œ ê°€ì ¸ì˜¤ê¸°
fi = pd.Series(model.feature_importances_)
fi.index = model.feature_names_in_
fi.nlargest(20)

# í”¼ì²˜ ì¤‘ìš”ë„ ì‹œê°í™” í•˜ê¸°
fi.nlargest(20).plot.barh()
```

![]({{ site.url }}{{ site.baseurl }}/assets/images/2022-11-15-hp,bz/Untitled 5.png)

## Submit

âš ï¸ **ì •ë‹µê°’ì„ ì…ë ¥í•˜ê¸° ì „ì— ì§€ìˆ˜í•¨ìˆ˜ ì²˜ë¦¬`(np.expm1)`ë¥¼ í•´ì„œ ì›ë˜ ìŠ¤ì¼€ì¼ë¡œ ë³µì›í•´ì¤˜ì•¼ í•œë‹¤!**
ë¦¬ë”ë³´ë“œì— ìˆëŠ” ì ìˆ˜ì™€ ë™ì¼í•œ ìŠ¤ì¼€ì¼ ì ìˆ˜ë¥¼ ë¯¸ë¦¬ ê³„ì‚°í•´ë³´ê¸° ìœ„í•´ì„œëŠ” ë¡œê·¸ ì ìš© ê°’ìœ¼ë¡œ ê³„ì‚°í•´ì£¼ì§€ë§Œ, ì œì¶œí•  ë–„ëŠ” ì§€ìˆ˜í•¨ìˆ˜ë¥¼ ì ìš©í•´ì„œ ì›ë˜ ìŠ¤ì¼€ì¼ë¡œ ë³µì›í•˜ì—¬ ì œì¶œí•´ì•¼ ì œëŒ€ë¡œ ëœ ì ìˆ˜ë¥¼ í‰ê°€ë°›ì„ ìˆ˜ ìˆë‹¤.

![]({{ site.url }}{{ site.baseurl }}/assets/images/2022-11-15-hp,bz/Untitled 6.png)

## ğŸ’¡ ì „ì²˜ë¦¬ ë°©ë²• ìš”ì•½

### ìˆ˜ì¹˜í˜•

- ê²°ì¸¡ì¹˜ ëŒ€ì²´(Imputation)
    - ìˆ˜ì¹˜í˜• ë³€ìˆ˜ë¥¼ ëŒ€ì²´í•  ë•ŒëŠ” ì›ë˜ì˜ ê°’ì´ ë„ˆë¬´ ì™œê³¡ë˜ì§€ ì•ŠëŠ”ì§€ë„ ì£¼ì˜ê°€ í•„ìš”.
    - ì¤‘ì•™ê°’(ì¤‘ê°„ê°’), í‰ê· ê°’ ë“±ì˜ ëŒ€í‘œê°’ìœ¼ë¡œ ëŒ€ì²´í•  ìˆ˜ë„ ìˆì§€ë§Œ, ë‹¹ë‡¨ë³‘ ì‹¤ìŠµì—ì„œ í–ˆë˜ íšŒê·€ë¡œ ì˜ˆì¸¡í•´ì„œ ì±„ìš°ëŠ” ë°©ë²•ë„ ìˆë‹¤.
    - ë‹¹ë‡¨ë³‘ ì‹¤ìŠµì—ì„œ í–ˆë˜ ì¸ìŠë¦°ì„ ì±„ìš¸ ë•Œ ë‹¹ë‡¨ë³‘ ì—¬ë¶€ì— ë”°ë¼ ëŒ€í‘œê°’ì„ êµ¬í•œ ê²ƒ ì²˜ëŸ¼ ì—¬ê¸°ì—ì„œë„ ë‹¤ë¥¸ ë³€ìˆ˜ë¥¼ ì°¸ê³ í•´ì„œ ì±„ì›Œë³¼ ìˆ˜ë„ ìˆë‹¤.
- ìŠ¤ì¼€ì¼ë§ - Standard, Min-Max, Robust
- ë³€í™˜ - log
- ì´ìƒì¹˜(ë„ˆë¬´ í¬ê±°ë‚˜ ì‘ì€ ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ëŠ” ê°’) ì œê±° í˜¹ì€ ëŒ€ì²´
- ì˜¤ë¥˜ê°’(ì˜ëª»ëœ ê°’) ì œê±° í˜¹ì€ ëŒ€ì²´
- ì´ì‚°í™” - cut, qcut

### ë²”ì£¼í˜•

- ê²°ì¸¡ì¹˜ ëŒ€ì²´(Imputation)
- ì¸ì½”ë”© - label, ordinal, one-hot-encoding
- ë²”ì£¼ ì¤‘ì— ë¹ˆë„ê°€ ì ì€ ê°’ì€ ëŒ€ì²´í•˜ê¸°

# **Mercedes-Benz Greener Manufacturing**

## ë¨¸ì‹ ëŸ¬ë‹ì˜ í•„ìš”ì„±

### ì œì¡°ì—…ì—ì„œ ë°ì´í„° ê³¼í•™ê³¼ ë¨¸ì‹ ëŸ¬ë‹ì˜ ì´ì ?

- í’ˆì§ˆê´€ë¦¬
- ì˜ˆë°© ì •ë¹„
- ìˆ˜ìš”ì˜ˆì¸¡
- í”„ë¡œì„¸ì‹± ì¡°ê±´(ìƒì‚° ê³¼ì •ì—ì„œ ì—¬ëŸ¬ ë³€ìˆ˜ë“¤ì˜ ì—­í•™ê´€ê³„ íŒŒì•…ì„ ìë™í™”í•˜ì—¬ ê³µì •ì„ ìµœì í™”)
- ì—°êµ¬ê°œë°œ(ìƒì‚° ê³¼ì •ì—ì„œ ì–»ì–´ë‚¸ ë¹…ë°ì´í„°ì™€ ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ë¨¸ì‹ ëŸ¬ë‹ì€ ìƒˆë¡œìš´ ì œí’ˆì„ ê°œë°œí•˜ê±°ë‚˜ ë‹¤ë¥¸ ê¸°ì—…ê³¼ í˜‘ì—…)
- ìŠ¤ë§ˆíŠ¸ ì œí’ˆ
- [ì‚°ì—… í”„ë¡œì„¸ìŠ¤ë¥¼ í˜ì‹ í•˜ëŠ” ë¨¸ì‹ ëŸ¬ë‹ ê¸°ìˆ  í™œìš© ì‚¬ë¡€](https://www.notion.so/11-07-titanic-Bike-Shareing-Demand-4d698434eb254dbc958aa0bd07ef4c1d)

## **ì„ í˜• íšŒê·€(Linear Regression)**

- ì„ í˜• íšŒê·€(linear regression)ëŠ” ì¢…ì† ë³€ìˆ˜ yì™€ í•œ ê°œ ì´ìƒì˜ ë…ë¦½ ë³€ìˆ˜ (ë˜ëŠ” ì„¤ëª… ë³€ìˆ˜) Xì™€ì˜ ì„ í˜• ìƒê´€ ê´€ê³„ë¥¼ ëª¨ë¸ë§í•˜ëŠ” íšŒê·€ë¶„ì„ ê¸°ë²•.
- ì„ í˜• íšŒê·€ëŠ” ì„ í˜• ì˜ˆì¸¡ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ íšŒê·€ì‹ì„ ëª¨ë¸ë§í•˜ë©°, ì•Œë ¤ì§€ì§€ ì•Šì€ íŒŒë¼ë¯¸í„°ëŠ” ë°ì´í„°ë¡œë¶€í„° ì¶”ì •í•œë‹¤.

## ë°ì´í„° ë¡œë“œ

```python
# train, test, submisson ë°ì´í„° ì…‹ì„ í˜¸ì¶œí•œë‹¤.
# dataë¥¼ ë°›ì„ ë•Œ .csv.zipìœ¼ë¡œ í™•ì¥ìê°€ ê¸°ì¡´ê³¼ ë‹¤ë¥¸ë° ë°”ê¿”ì¤„ í•„ìš”ëŠ” ì—†ë‹¤.
train = pd.read_csv(f'{base_path}/train.csv.zip', index_col="ID")
test = pd.read_csv(f'{base_path}/test.csv.zip', index_col="ID")
submission = pd.read_csv(f'{base_path}/sample_submission.csv.zip', index_col="ID")

# trainì˜ ë°ì´í„°ì…‹ì„ ê°„ë‹¨íˆ ì‚´í´ë³¸ë‹¤
train.head(2)
```

![]({{ site.url }}{{ site.baseurl }}/assets/images/2022-11-15-hp,bz/Untitled 7.png)

ë°ì´í„°ë¥¼ ì‚´í´ë³´ë©´ ì–´ë–¤ ì§€í‘œë“¤ì¸ì§€ ì¸ì§€í•˜ê¸°ê°€ ì–´ë µë‹¤.  ì´ëŠ” ë²¤ì¸ ì—ì„œ ê²½ì§„ëŒ€íšŒë¥¼ ê°œìµœí–ˆì„ ë•Œ ì‚¬ë‚´ ë³´ì•ˆìƒì˜ ì´ìœ ë¡œ ì¸í•´ ë°ì´í„°ë“¤ì„ ì¼ì¢…ì˜ ì•”í˜¸í™”ë¡œ ì²˜ë¦¬í•´ì„œ ê³µê°œí•œ ê²ƒì´ë‹¤.

XëŠ” feature, ë…ë¦½ë³€ìˆ˜, 2ì°¨ì› array í˜•íƒœ, í•™ìŠµí•  í”¼ì²˜, ì˜ˆ) ì‹œí—˜ì˜ ë¬¸ì œ

yëŠ” label, ì¢…ì†ë³€ìˆ˜, target, ì •ë‹µ, 1ì°¨ì› ë²¡í„°, ì˜ˆ) ì‹œí—˜ì˜ ì •ë‹µ

ì—¬ê¸°ì„œ 'y'ëŠ” ì œì¡° ê³¼ì •ì—ì„œ í…ŒìŠ¤íŠ¸ ë‹¨ê³„ì— ë“œëŠ” ì‹œê°„ì„ ì˜ˆì¸¡ì„ ì˜ë¯¸í•œë‹¤.

```python
# testë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
test.head(2)
```

![]({{ site.url }}{{ site.baseurl }}/assets/images/2022-11-15-hp,bz/Untitled 8.png)

```python
# subë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
submission.head(2)
```

![]({{ site.url }}{{ site.baseurl }}/assets/images/2022-11-15-hp,bz/Untitled 9.png)

## EDA

```python
# info
train.info()

ê²°ê³¼ê°’:
<class 'pandas.core.frame.DataFrame'>
Int64Index: 4209 entries, 0 to 8417
Columns: 377 entries, y to X385
dtypes: float64(1), int64(368), object(8)
memory usage: 12.1+ MB
```

```python
# describe
train.describe()
```

![]({{ site.url }}{{ site.baseurl }}/assets/images/2022-11-15-hp,bz/Untitled 10.png)

ê¸°ìˆ í†µê³„ê°’(describe)ë¥¼ êµ¬í•´ë³´ë‹ˆ ë„ˆë¬´ ë§ì€ featureë“¤ì´ ì¡´ì¬í•œë‹¤. ì´ ì¤‘ì—ì„œ í•„ìš” ì—†ëŠ” ê°’ì´ ìˆëŠ”ì§€ë¥¼ í™•ì¸í•´ë³´ì.

```python
# nunique
train_nunique = train.nunique().sort_values()
train_nunique

ê²°ê³¼ê°’:
X290       1
X235       1
X11        1
X297       1
X347       1
        ... 
X1        27
X5        29
X2        44
X0        47
y       2545
Length: 377, dtype: int64
```

1ì¸ featureë“¤ì´ ë‹¤ìˆ˜ ìˆëŠ” ê²ƒìœ¼ë¡œ ë³´ì¸ë‹¤. í•´ë‹¹ featureë“¤ì„ ì œê±°í•˜ê³  ì§„í–‰í•´ë³´ë„ë¡ í•œë‹¤.

```python
# ê°’ì´ 1ì¸ ë°ì´í„° ì°¾ê¸°
train_one_idx = train_nunique[train_nunique == 1].index
train_one_idx

ê²°ê³¼ê°’:
Index(['X290', 'X235', 'X11', 'X297', 'X347', 'X268', 'X107', 'X293', 'X330',
       'X289', 'X93', 'X233'],
      dtype='object')
```

í•´ë‹¹ ê°’ë“¤ì˜ `describe()`ë¥¼ í™•ì¸í•´ë³´ì.

```python
train[train_one_idx].describe()
```

![]({{ site.url }}{{ site.baseurl }}/assets/images/2022-11-15-hp,bz/Untitled 11.png)

ê¸°ìˆ í†µê³„ê°’ì„ ë³´ë©´ ëª¨ë‘ ê°™ì€ ê°’ì´ ìˆê³  ê²°ì¸¡ì¹˜ê°€ ì—†ë‹¤. ë˜í•œ, 0ìœ¼ë¡œë§Œ ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ëª¨ë‘ ì‚­ì œí•´ë„ ë¬¸ì œê°€ ì—†ì–´ë³´ì¸ë‹¤.

```python
# í•„ìš”ì—†ëŠ” ë°ì´í„° ì œê±°
# ìœ„ ì½”ë“œëŠ” í•œë²ˆë§Œ ì‹¤í–‰í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤.
# 2ë²ˆ ì´ìƒ í•˜ë©´ ì—ëŸ¬ë¥¼ ìœ ë°œí•  ìˆ˜ ìˆë‹¤.
train = train.drop(columns=train_one_idx)
test = test.drop(columns=train_one_idx)
```

ì´ì œ heatmapì„ í†µí•´ì„œ ê¸°ìˆ í†µê³„ê°’ì„ êµ¬í•˜ë„ë¡ í•œë‹¤. ê¸°ì¡´ì˜ ê¸°ìˆ í†µê³„ë¥¼ êµ¬í–ˆì„ ë•Œ ìˆ˜ì¹˜ë°ì´í„°ê°€ ë„ˆë¬´ ë§ê¸° ë•Œë¬¸ì— ì¼ë‹¨ ì‹œê°í™” í•˜ì—¬ í‘œí˜„í•´ë³¸ë‹¤. ì •ë‹µì¸ yë¥¼ ì œì™¸í•˜ê³  ì–´ë–¤ ê°’ì´ í¬ê³  ì‘ì€ì§€ í™•ì¸í•˜ë„ë¡ í•œë‹¤.

```python
plt.figure(figsize = (15,15))
sns.heatmap(train.select_dtypes(include="number").drop(columns = "y"), cmap = "Greys")
```

![]({{ site.url }}{{ site.baseurl }}/assets/images/2022-11-15-hp,bz/Untitled 12.png)

ëª¨ë“  ìˆ˜ì¹˜ë°ì´í„°ê°€ 0~1 ì‚¬ì´ì˜ ê°’ì´ë‹¤. ì´ëŠ” Min-Max ë²”ìœ„ì¡°ì •ì´ ë˜ì–´ ìˆì–´ ìŠ¤ì¼€ì¼ë§ í•  í•„ìš”ê°€ ì—†ì–´ ë³´ì¸ë‹¤. ì¦‰ , ì´ ë°ì´í„°ëŠ” ì •ê·œí™”ë˜ì–´ ì œê³µë˜ê³  ìˆëŠ” ë°ì´í„°ë¼ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

## One-Hot-Encoding

OneHotEncoderëŠ” ì „ì²´ ë°ì´í„°ë¥¼ ë³€í™˜í•˜ê¸° ë•Œë¬¸ì— ë²”ì£¼í˜• ë¿ë§Œ ì•„ë‹ˆë¼ ìˆ˜ì¹˜ ë°ì´í„° ëª¨ë‘ ì¸ì½”ë”©í•œë‹¤.
ê·¸ë˜ì„œ ë²”ì£¼ê°’ ë°ì´í„°ë§Œ ë”°ë¡œ ë„£ì–´ ì¸ì½”ë”©í•´ì£¼ì–´ì•¼ í•œë‹¤. `pd.get_dummies()`ì˜ ì¥ì ì€ ì´ëŸ° ì „ì²˜ë¦¬ ì—†ì´ ë²”ì£¼ ë°ì´í„°ë§Œ OneHotEncodingí•œë‹¤ëŠ” ì ì´ë‹¤. ê·¸ë˜ì„œ, ë³€ìˆ˜ê°€ ë§ì„ ë•Œ OneHotEncoderë‚˜ `pd.get_dummise()`ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

```python
from sklearn.preprocessing import OneHotEncoder

# handle_unknown : trainì—ëŠ” ë“±ì¥í•˜ì§€ë§Œ, testì—ëŠ” ì—†ë‹¤ë©´ ë¬´ì‹œí•œë‹¤.
# drop : OHEë¥¼ í•  ë•Œ ì–´ë–¤ ì»¬ëŸ¼ì„ ìƒì„±í•˜ì§€ ì•ŠëŠ”ì§€ì— ëŒ€í•œ ì˜µì…˜ì´ë‹¤.
#        if_binary : binary ê°™ì€ ê²½ìš°ë§Œ í•œê°œë¥¼ ë²„ë¦¬ê²Œ í•œë‹¤.
ohe = OneHotEncoder(drop="if_binary", handle_unknown="ignore")

# trainì„ ê¸°ì¤€ìœ¼ë¡œ featureë¥¼ ë§Œë“œëŠ”ë°, testì—ëŠ” trainì— ì—†ëŠ” ê°’ì´ ìˆë‹¤ë©´ ê·¸ ê°’ì€ featureë¡œ ë§Œë“¤ì§€ ì•ŠëŠ”ë‹¤.
# fitì€ trainì„ ê¸°ì¤€ìœ¼ë¡œ ì‚¼ê¸° ë•Œë¬¸ì— trainë§Œ ì§„í–‰í•œë‹¤.
# transformì€ train, test ë‘˜ë‹¤ ì§„í–‰í•œë‹¤.
train_ohe = ohe.fit_transform(train.select_dtypes(exclude="number"))
test_ohe = ohe.transform(test.select_dtypes(exclude="number"))

print(train_ohe.shape, test_ohe.shape)
ê²°ê³¼ê°’ : (4209, 195) (4209, 195)
```

```python
# ë°˜í™˜ê°’ì´ np.array í˜•íƒœì´ê¸° ë•Œë¬¸ì— ë°ì´í„°í”„ë ˆì„ìœ¼ë¡œ ë³„ë„ì˜ ë³€í™˜ì´ í•„ìš”í•˜ë‹¤.
df_train_ohe = pd.DataFrame(train_ohe.toarray(), columns = ohe.get_feature_names_out())
```

![]({{ site.url }}{{ site.baseurl }}/assets/images/2022-11-15-hp,bz/Untitled 13.png)

```python
df_test_ohe = pd.DataFrame(test_ohe.toarray(), columns = ohe.get_feature_names_out())
```

![]({{ site.url }}{{ site.baseurl }}/assets/images/2022-11-15-hp,bz/Untitled 14.png)

ì¸ì½”ë”©í•œ ë¶„ë¥˜í˜• ë³€ìˆ˜ë“¤ì„ ì›ë˜ dfì™€ ê²°í•©ì„ ì§„í–‰í•œë‹¤.

```python
# ìˆ˜ì¹˜í˜• ë³€ìˆ˜ë“¤ë§Œ ë”°ë¡œ ë½‘ì•„ë‚¸ë‹¤.
train_num = train.select_dtypes(include="number")
# ìˆ˜ì¹˜í˜• ë³€ìˆ˜ì™€ ì „ì²˜ë¦¬ëœ ë¶„ë¥˜í˜• ë³€ìˆ˜ë¥¼ í•©ì¹œë‹¤.
pd.concat([train_num, df_train_ohe], axis = 1)
```

![]({{ site.url }}{{ site.baseurl }}/assets/images/2022-11-15-hp,bz/Untitled 15.png)